[{"E:\\桌面应用\\demo\\react\\notebook\\src\\App.js":"1","E:\\桌面应用\\demo\\react\\notebook\\src\\reportWebVitals.js":"2","E:\\桌面应用\\demo\\react\\notebook\\src\\components\\FileSearch.js":"3","E:\\桌面应用\\demo\\react\\notebook\\src\\index.js":"4","E:\\桌面应用\\demo\\react\\notebook\\src\\utils\\defaultFiles.js":"5","E:\\桌面应用\\demo\\react\\notebook\\src\\components\\FileList.js":"6","E:\\桌面应用\\demo\\react\\notebook\\src\\hooks\\useKeyPress.js":"7","E:\\桌面应用\\demo\\react\\notebook\\src\\components\\BottomBtn.js":"8","E:\\桌面应用\\demo\\react\\notebook\\src\\components\\TabList.js":"9","E:\\桌面应用\\demo\\react\\notebook\\src\\utils\\Helper.js":"10","E:\\桌面应用\\demo\\react\\notebook\\src\\utils\\FileHelper.js":"11"},{"size":11158,"mtime":1609588327505,"results":"12","hashOfConfig":"13"},{"size":362,"mtime":1607590342266,"results":"14","hashOfConfig":"13"},{"size":2802,"mtime":1609410413322,"results":"15","hashOfConfig":"13"},{"size":500,"mtime":1607590342266,"results":"16","hashOfConfig":"13"},{"size":446,"mtime":1609333954240,"results":"17","hashOfConfig":"13"},{"size":7367,"mtime":1609583019693,"results":"18","hashOfConfig":"13"},{"size":995,"mtime":1609338230872,"results":"19","hashOfConfig":"13"},{"size":694,"mtime":1609141213813,"results":"20","hashOfConfig":"13"},{"size":2467,"mtime":1609570976880,"results":"21","hashOfConfig":"13"},{"size":324,"mtime":1609573647411,"results":"22","hashOfConfig":"13"},{"size":1112,"mtime":1609581627129,"results":"23","hashOfConfig":"13"},{"filePath":"24","messages":"25","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"26"},"x6gxv5",{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"29","messages":"30","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"33"},{"filePath":"34","messages":"35","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"36"},{"filePath":"37","messages":"38","errorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"39","messages":"40","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"41"},{"filePath":"42","messages":"43","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"44","messages":"45","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"46","messages":"47","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"48","messages":"49","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"E:\\桌面应用\\demo\\react\\notebook\\src\\App.js",["50"],"import './App.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport SimpleMDE from 'react-simplemde-editor';\nimport { v4  } from 'uuid';\nimport {\n  faPlusSquare,\n  faUpload\n} from '@fortawesome/free-solid-svg-icons';\nimport \"easymde/dist/easymde.min.css\";\nimport React, { useEffect,useState } from 'react';\nimport PropTypes from 'prop-types';\nimport FileSearch from \"./components/FileSearch.js\";\nimport FileList from \"./components/FileList.js\";\nimport BottomBtn from \"./components/BottomBtn.js\";\nimport TabList from \"./components/TabList.js\";\nimport FileHelper from './utils/FileHelper.js';\nimport {\n  ObjToArr,\n  returnTimes\n} from \"./utils/Helper.js\";\nimport useKeyPress from './hooks/useKeyPress.js';\n\nconst path = window.require('path');\nconst remote = window.require('electron').remote;\nconst Store = window.require('electron-store');\nconst store = new Store({'name': 'File Data'});\nconst basePath = remote.app.getPath('userData'); // basePath/notebook(项目名称)/File Data.json\nconst saveFilesToStore = (files) =>{\n  const filesStoreObj = Object.values(files).reduce((result, file) => {\n      const { id, filePath, title, createAt } = file\n      result[id] = {\n        id,\n        filePath,\n        title,\n        createAt\n      }\n      return result\n    }, {})\n    store.set('files', filesStoreObj)\n}\n\n\nfunction App() {\n  const [files, setFiles] = useState(store.get('files') || {}) //\n  const [searchKeysword, setSearchKeysword] = useState('')\n  const [searching, setSearching] = useState(false)\n  const [unSavedFiles, setUnSavedFiles] = useState({})\n  const [activeFileId, setActiveFileId] = useState('')\n  const [openedFileIds, setOpenedFileIds] = useState([])\n  const [editingFileName, setEitingFileName] = useState(false)\n\n\n  // 1.new file\n  const CreateFile = () => {\n    if (editingFileName) {\n      // 延时执行alert是为了避免alert影响键盘事件的监听\n      setTimeout(() => {\n        alert('请关闭文件名编辑后在操作！')\n      }, 100);\n      return\n    }\n    const newFile = {\n      id: v4(),\n      title: '',\n      body: \"## 请输出 Markdown\",\n      createAt: (new Date()).getTime(),\n      isNew: true\n    }\n    setFiles({\n      ...files,\n      [newFile.id]: newFile\n    })\n    // OpenFile(newFile.id)\n  }\n\n  // 2.delete file\n  const DelFile = (id) => {\n    try {\n      FileHelper.removeFileSync(files[id].filePath)\n    } catch (error) {\n      alert(error)\n    }\n    const { [id]: delfile, ...resfiles } = files\n    CloseFile(id)\n    setFiles(resfiles)\n    saveFilesToStore(resfiles)\n    // if active file,close it\n    \n  }\n  // 3.remove file from list\n  const RemoveFile = (id) => {\n    const {\n      [id]: delfile, ...resfiles\n    } = files\n    CloseFile(id)\n    setFiles(resfiles)\n    saveFilesToStore(resfiles)\n    // if active file,close it\n  }\n\n\n  //4. add unsavefile  (change file but unsave)\n  const UpdateOpenFile = (id, newValue) => {\n    const curFile = activeFile\n    if (curFile.body === newValue) return\n    const newFile = {\n      ...curFile,\n      body: newValue\n    }\n    setUnSavedFiles({\n      ...unSavedFiles,\n      [id]: newFile\n    })\n  }\n\n  // 5. edit and save file\n  const UpdateFile = (id, key, newValue) => {\n    try {\n      let newFile = {\n        ...files[id],\n        isNew: false\n      }\n      if (key === 'title') {\n        if (files[id].title === newValue) return // 没改\n        const oldPath = newFile.filePath\n        const newPath = oldPath ? path.join(path.dirname(oldPath), `${newValue}.md`) : path.join(basePath, `${newValue}.md`)\n        \n        newFile.filePath = newPath\n        newFile.title = newValue\n\n        const oldName = files[id].title\n        if(oldName) {\n          FileHelper.renameSync(oldPath, newPath)\n        } else {\n          // 新建的文件\n          FileHelper.writeFileSync(newFile.filePath, newFile.body)\n        }\n      } else {\n        // body\n        FileHelper.writeFileSync(newFile.filePath, newValue)\n      }\n      const newfiles = {\n        ...files,\n        [id]: newFile\n      }\n      setFiles(newfiles)\n      if (key === 'title') saveFilesToStore(newfiles)\n    } catch (error) {\n      alert(error)\n    }\n  }\n\n  //6.save file   (while activefile is unsave, 'ctrl+s' to save it)\n  const ctrlPressed = useKeyPress(17)\n  const sPressed = useKeyPress(83)\n  useEffect(() => {\n    if (ctrlPressed && sPressed && activeFileId && unSavedFiles[activeFileId]) {\n      const body = unSavedFiles[activeFileId].body\n      const {\n        [activeFileId]: delFile,\n        ...resUnsavedFiles\n      } = unSavedFiles\n      setUnSavedFiles(resUnsavedFiles)\n      UpdateFile(activeFileId, 'body', body)\n    }\n  }, [ctrlPressed, sPressed])\n  \n  // 7.open file\n  const OpenFile = (id) => {\n    //add to openfiles\n    if (!openedFileIds.includes(id)) {\n      setOpenedFileIds([...openedFileIds, id])\n    }\n    // set active file\n    setActiveFileId(id)\n  }\n\n  // 8.close file\n  const CloseFile = (id) => {\n    //if change active file\n    if (id === activeFileId) setActiveFileId(openedFileIds.length > 1 ? openedFileIds[0] : '')\n    // remove from openfiles\n    const newOpenedFileIds = openedFileIds.filter(item => item !== id)\n    setOpenedFileIds(newOpenedFileIds)\n    \n  }\n\n  // 9.change active file  (tab click)\n  const ChangeTabActiveFile = (id) => {\n    //if change active file\n    if (id !== activeFileId) setActiveFileId(id)\n  }\n\n  //10. search File\n  const searchFile = (keywords = '') => {\n    setSearchKeysword(keywords)\n  }\n  const getActFile = (id) => {\n     const actFile = unSavedFiles[activeFileId] || files[activeFileId] || null\n     if (!actFile) return\n     if (actFile.isLoaded) return actFile\n\n     try {\n      let body = ''\n      if (actFile.filePath) {\n          body = FileHelper.readFileSync(actFile.filePath)\n      }\n      return {\n        ...actFile,\n        body,\n        isLoaded: true\n      }\n     } catch (error) {\n      //  注意：window.confirm弹框需要确认2次yes才算yes\n      if (window.confirm(`{\\n${error}\\n}\\n\\n确定将此文件移出Markdown文件列表？`)) RemoveFile(id)\n     }\n  }\n  // 11.导入文件\n  const importFiles = () => {\n    remote.dialog.showOpenDialog({\n      title:'选择导入的 Markdown 文件', //String(可选) - 对话框窗口的标题\n      //defaultPath: //String(可选) - 对话框的默认展示路径\n      buttonLabel:'导入', //String(可选) - 「确认」 按钮的自定义标签, 当为空时, 将使用默认标签。\n      filters: [{\n        name: 'Markdown Files',\n        extensions: ['md']\n      }], //FileFilter[](可选)\n      properties: ['openFile', 'multiSelections']\n    }).then(res=>{\n      //点击了确认导入\n      if (!res.canceled) {\n        const importResFiles = res.filePaths\n        const isSameName = (title) => {\n          return !!Object.values(files).find((file) => {\n            return file.title === title\n          })\n        }\n        let impFiles = importResFiles.reduce((result, filePath) => {\n          const title = path.basename(filePath, '.md')\n          if(isSameName(title)) throw new Error(`已存在同名文件${title}`)\n          // if (isSameName(title)) {\n          //   alert(`已存在同名文件${title}`)\n          //   return\n          // }\n          const nfile = {\n            id: v4(),\n            title,\n            filePath,\n            createAt: returnTimes()\n          }\n          result[nfile.id] = nfile\n          return result\n        },{})\n        const newfiles = {\n          ...files,\n          ...impFiles\n        }\n        setFiles(newfiles)\n        saveFilesToStore(newfiles)\n      }\n    }).catch(err=>{\n      // console.error(err);\n      alert(err)\n    })\n  }\n  console.log('do');\n  // left filelist\n  const filesArr = ObjToArr(files).filter(file => {\n    return file.title.includes(searchKeysword)\n  })\n  // activeFile base unsaveFiles or files\n  let activeFile = getActFile(activeFileId)\n  // get unsavefile ids\n  const unSavedFileIds = Object.keys(unSavedFiles)\n  // openedFilesArr base unsaveFiles or files\n  const openedFilesArr = openedFileIds.map(id => unSavedFiles[id] || files[id])\n  \n  return (\n    <div className=\"App container-fluid px-0\">\n      <div className=\"row no-gutters\">\n        <div className = \"col-3 d-flex flex-column left-panel\">\n          <FileSearch onFileSearch={searchFile} searchStateChange={(flag)=>{setSearching(flag)}} />\n          <div className=\"flex-grow-1 overflow-auto\">\n            <FileList\n              files={filesArr}\n              onFileClickFunc={OpenFile}\n              onFileNameSaveEdit = {UpdateFile}\n              onFileRemoveFunc = {\n                (id) => {\n                  const res = window.confirm(\"确认此文件移出Markdown文件列表？\")\n                  if (res) {\n                    RemoveFile(id)\n                  }\n                }\n              }\n              onFileDeleteFunc={(id)=>{\n                const res = window.confirm(\"确认将此文件从文件资源管理器中删除？\")\n                if (res) {\n                  DelFile(id)\n                }\n              }}\n              onFileNameEditStart = {\n                (flag) => {\n                  setEitingFileName(!!flag);\n                }\n              }\n              />\n            </div>\n            {\n              !searching && \n              <div className = \"row no-gutters\">\n                <div className=\"col-6\">\n                  <BottomBtn \n                    text=\"新建\"\n                    icon={faPlusSquare}\n                    colorClass = \"btn-primary\"\n                    onBtnClick={()=>{CreateFile()}}\n                    />\n                </div>\n                <div className=\"col-6\">\n                  <BottomBtn \n                    text=\"导入\"\n                    icon={faUpload}\n                    colorClass=\"btn-success\"\n                    onBtnClick = {\n                      () => {\n                        importFiles()\n                      }\n                    }\n                    />\n                </div>\n              </div>\n            }\n        </div>\n        {\n          !activeFile &&\n          <div className=\"placeholder\">选择或创建新的Markdown文档</div>\n        }\n        {\n          activeFile &&\n          <div className=\"col-9 right-panel\">\n            <TabList\n              files = {openedFilesArr}\n              unSavedIds = {unSavedFileIds}\n              activeId = {activeFileId}\n              onTabClick = {ChangeTabActiveFile}\n              onTabClose = {CloseFile}\n            />\n            <SimpleMDE\n              key={activeFileId}\n              value = {activeFile && activeFile.body}\n              options={{\n                minHeight: '470px'\n              }}\n              onChange = {\n                (value) => {\n                  UpdateOpenFile(activeFileId, value)\n                }\n              }\n              />\n          </div>\n        }\n        \n      </div>\n    </div>\n  );\n}\nApp.propTypes = {\n  files: PropTypes.object,\n  searchKeysword: PropTypes.string,\n  searching: PropTypes.bool,\n  unSavedFiles: PropTypes.object,\n  activeFileId: PropTypes.string,\n  openedFileIds: PropTypes.array,\n  editingFileName: PropTypes.bool,\n}\n\nexport default App;\n","E:\\桌面应用\\demo\\react\\notebook\\src\\reportWebVitals.js",[],"E:\\桌面应用\\demo\\react\\notebook\\src\\components\\FileSearch.js",["51","52","53"],"E:\\桌面应用\\demo\\react\\notebook\\src\\index.js",[],["54","55"],"E:\\桌面应用\\demo\\react\\notebook\\src\\utils\\defaultFiles.js",[],["56","57"],"E:\\桌面应用\\demo\\react\\notebook\\src\\components\\FileList.js",["58","59","60","61","62"],"E:\\桌面应用\\demo\\react\\notebook\\src\\hooks\\useKeyPress.js",["63"],"import { useState, useEffect } from 'react';\r\n// 监听某键盘按键是否被按下,true:down,false:up,返回true or false\r\nconst useKeyPress = (targetKeyCode) => {\r\n    const [keyPressed, setKeyPressed] = useState(false)\r\n    // 按下是true,弹起是false\r\n    const keyDownHandler = ({keyCode}) => {\r\n        if (keyCode === targetKeyCode) setKeyPressed(true)\r\n    }\r\n    const keyUpHandler = ({\r\n        keyCode\r\n    }) => {\r\n        if (keyCode === targetKeyCode) setKeyPressed(false)\r\n    }\r\n    useEffect(() => {\r\n        // 加载时添加监听\r\n        document.addEventListener('keydown', keyDownHandler)\r\n        document.addEventListener('keyup', keyUpHandler)\r\n\r\n        // 卸载时清除监听\r\n        return(\r\n            () => {\r\n                document.removeEventListener('keydown', keyDownHandler)\r\n                document.removeEventListener('keyup', keyUpHandler)\r\n            }\r\n        )\r\n    }, []) //[]加载\r\n    return keyPressed\r\n}\r\nexport default useKeyPress","E:\\桌面应用\\demo\\react\\notebook\\src\\components\\BottomBtn.js",[],"E:\\桌面应用\\demo\\react\\notebook\\src\\components\\TabList.js",["64"],"E:\\桌面应用\\demo\\react\\notebook\\src\\utils\\Helper.js",[],"E:\\桌面应用\\demo\\react\\notebook\\src\\utils\\FileHelper.js",[],{"ruleId":"65","severity":1,"message":"66","line":166,"column":6,"nodeType":"67","endLine":166,"endColumn":29,"suggestions":"68"},{"ruleId":"65","severity":1,"message":"69","line":18,"column":8,"nodeType":"67","endLine":18,"endColumn":21,"suggestions":"70"},{"ruleId":"65","severity":1,"message":"71","line":26,"column":8,"nodeType":"67","endLine":26,"endColumn":22,"suggestions":"72"},{"ruleId":"65","severity":1,"message":"73","line":29,"column":8,"nodeType":"67","endLine":29,"endColumn":20,"suggestions":"74"},{"ruleId":"75","replacedBy":"76"},{"ruleId":"77","replacedBy":"78"},{"ruleId":"75","replacedBy":"79"},{"ruleId":"77","replacedBy":"80"},{"ruleId":"81","severity":1,"message":"82","line":1,"column":37,"nodeType":"83","messageId":"84","endLine":1,"endColumn":43},{"ruleId":"65","severity":1,"message":"85","line":49,"column":8,"nodeType":"67","endLine":49,"endColumn":22,"suggestions":"86"},{"ruleId":"65","severity":1,"message":"87","line":54,"column":8,"nodeType":"67","endLine":54,"endColumn":20,"suggestions":"88"},{"ruleId":"65","severity":1,"message":"89","line":62,"column":8,"nodeType":"67","endLine":62,"endColumn":31,"suggestions":"90"},{"ruleId":"65","severity":1,"message":"91","line":62,"column":9,"nodeType":"92","endLine":62,"endColumn":30},{"ruleId":"65","severity":1,"message":"93","line":26,"column":8,"nodeType":"67","endLine":26,"endColumn":10,"suggestions":"94"},{"ruleId":"95","severity":1,"message":"96","line":30,"column":29,"nodeType":"97","endLine":37,"endColumn":30},"react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'UpdateFile', 'activeFileId', and 'unSavedFiles'. Either include them or remove the dependency array.","ArrayExpression",["98"],"React Hook useEffect has a missing dependency: 'searchStateChange'. Either include it or remove the dependency array. If 'searchStateChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["99"],"React Hook useEffect has missing dependencies: 'inputActive', 'onFileSearch', and 'value'. Either include them or remove the dependency array. If 'onFileSearch' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["100"],"React Hook useEffect has missing dependencies: 'closeSearch' and 'inputActive'. Either include them or remove the dependency array.",["101"],"no-native-reassign",["102"],"no-negated-in-lhs",["103"],["102"],["103"],"no-unused-vars","'useRef' is defined but never used.","Identifier","unusedVar","React Hook useEffect has missing dependencies: 'editStatic', 'ifCanChangeFileName', and 'value'. Either include them or remove the dependency array.",["104"],"React Hook useEffect has a missing dependency: 'onFileNameEditStart'. Either include it or remove the dependency array. If 'onFileNameEditStart' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["105"],"React Hook useEffect has a missing dependency: 'files'. Either include it or remove the dependency array.",["106"],"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","CallExpression","React Hook useEffect has missing dependencies: 'keyDownHandler' and 'keyUpHandler'. Either include them or remove the dependency array.",["107"],"jsx-a11y/anchor-is-valid","The href attribute requires a valid value to be accessible. Provide a valid, navigable address as the href value. If you cannot provide a valid href, but still need the element to resemble a link, use a button and change it with appropriate styles. Learn more: https://github.com/evcohen/eslint-plugin-jsx-a11y/blob/master/docs/rules/anchor-is-valid.md","JSXOpeningElement",{"desc":"108","fix":"109"},{"desc":"110","fix":"111"},{"desc":"112","fix":"113"},{"desc":"114","fix":"115"},"no-global-assign","no-unsafe-negation",{"desc":"116","fix":"117"},{"desc":"118","fix":"119"},{"desc":"120","fix":"121"},{"desc":"122","fix":"123"},"Update the dependencies array to be: [UpdateFile, activeFileId, ctrlPressed, sPressed, unSavedFiles]",{"range":"124","text":"125"},"Update the dependencies array to be: [inputActive, searchStateChange]",{"range":"126","text":"127"},"Update the dependencies array to be: [enterPressed, inputActive, onFileSearch, value]",{"range":"128","text":"129"},"Update the dependencies array to be: [closeSearch, escPressed, inputActive]",{"range":"130","text":"131"},"Update the dependencies array to be: [editStatic, enterPressed, ifCanChangeFileName, value]",{"range":"132","text":"133"},"Update the dependencies array to be: [editStatic, onFileNameEditStart]",{"range":"134","text":"135"},"Update the dependencies array to be: [files]",{"range":"136","text":"137"},"Update the dependencies array to be: [keyDownHandler, keyUpHandler]",{"range":"138","text":"139"},[4539,4562],"[UpdateFile, activeFileId, ctrlPressed, sPressed, unSavedFiles]",[780,793],"[inputActive, searchStateChange]",[1005,1019],"[enterPressed, inputActive, onFileSearch, value]",[1106,1118],"[closeSearch, escPressed, inputActive]",[1419,1433],"[editStatic, enterPressed, ifCanChangeFileName, value]",[1533,1545],"[editStatic, onFileNameEditStart]",[1730,1753],"[files]",[859,861],"[keyDownHandler, keyUpHandler]"]